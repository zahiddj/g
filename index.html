<!DOCTYPE html>
<html>
<head>
    <title>Nebula Fury - Next-Gen Browser Tech Demo</title>
    <style>
        * { margin: 0; padding: 0; }
        body { overflow: hidden; }
        canvas { width: 100vw; height: 100vh; }
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #fff;
            font-family: system-ui;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>
    <div id="hud">
        <div>FPS: <span id="fps">0</span></div>
        <div>POLYGONS: <span id="polycount">0</span></div>
    </div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
import { EffectComposer } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js';
import { RenderPass } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js';
import { SMAAPass } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/SMAAPass.js';

class TechDemo {
    constructor() {
        this.init();
    }

    async init() {
        // Core Systems
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        this.renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        this.clock = new THREE.Clock();
        
        // Configuration
        this.config = {
            POST_PROCESSING: true,
            DYNAMIC_LOD: true,
            PARTICLE_COUNT: 5000
        };

        // Initialize
        this.setupRenderer();
        this.createEnvironment();
        this.setupPostProcessing();
        this.createTechArt();
        this.gameLoop();
    }

    setupRenderer() {
        this.renderer.setPixelRatio(window.devicePixelRatio);
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.shadowMap.enabled = true;
        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(this.renderer.domElement);
    }

    createEnvironment() {
        // HDR Environment
        const envTexture = new THREE.CubeTextureLoader()
            .setPath('https://threejs.org/examples/textures/cube/pisa/')
            .load(['px.png', 'nx.png', 'py.png', 'ny.png', 'pz.png', 'nz.png']);
        this.scene.environment = envTexture;

        // Terrain
        const terrainGeometry = new THREE.PlaneGeometry(100, 100, 100, 100);
        const terrainMaterial = new THREE.MeshStandardMaterial({
            color: 0x303030,
            metalness: 0.8,
            roughness: 0.2
        });
        this.terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
        this.terrain.rotation.x = -Math.PI / 2;
        this.scene.add(this.terrain);

        // Dynamic Lighting
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(0, 50, 0);
        light.castShadow = true;
        this.scene.add(light);
    }

    setupPostProcessing() {
        this.composer = new EffectComposer(this.renderer);
        this.composer.addPass(new RenderPass(this.scene, this.camera));
        
        if(this.renderer.getPixelRatio() === 1) {
            this.composer.addPass(new SMAAPass());
        }
    }

    createTechArt() {
        // Nanite-style Geometry
        const complexGeometry = new THREE.IcosahedronGeometry(2, 8);
        const complexMaterial = new THREE.MeshStandardMaterial({
            color: 0x00ffff,
            metalness: 0.9,
            roughness: 0.1
        });

        for(let i = 0; i < 100; i++) {
            const mesh = new THREE.Mesh(complexGeometry, complexMaterial);
            mesh.position.set(
                (Math.random() - 0.5) * 50,
                1,
                (Math.random() - 0.5) * 50
            );
            mesh.castShadow = true;
            this.scene.add(mesh);
        }
    }

    gameLoop() {
        const delta = this.clock.getDelta();
        
        // Update HUD
        document.getElementById('fps').textContent = Math.round(1 / delta);
        document.getElementById('polycount').textContent = 
            this.renderer.info.render.triangles.toLocaleString();

        // Render
        this.composer.render();
        
        requestAnimationFrame(() => this.gameLoop());
    }
}

// Initialize Demo
new TechDemo();
</script>
</body>
</html>
